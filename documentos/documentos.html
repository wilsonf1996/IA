<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentos</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            margin: 20px;
            background-image: url('https://raw.githubusercontent.com/wilsonf1996/index.html/main/DALL%C2%B7E%202023-12-23%2013.03.50%20-%20mpressionante%20imagem%20de%20fundo%20de%20tela%20para%20aplicativo%20web%20de%20engenheiro%20civil%20fundo%20branco%2C%20hiper-realista%20e%20com%20designer%20moderno.%20A%20imagem%20deve%20ser%20r.png');
            background-size: cover;
            background-position: center;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
        }

        h1 {
            color: #333;
        }

        table {
            width: 100%;
            margin: 20px auto;
            border-collapse: collapse;
            overflow-y: scroll;
            max-height: 400px;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        button {
            padding: 10px;
            font-size: 16px;
            margin: 0 10px;
        }

        input {
            width: 80%;
            margin: 10px 0;
        }

        #files-table {
            overflow-y: auto;
        }
    </style>
    <!-- Carregue a biblioteca do Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
</head>

<body>
    <h1>Documentos</h1>

    <table id="files-table">
        <thead>
            <tr>
                <th>Nome do Arquivo</th>
                <th>Data e Hora de Upload</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody id="files-body"></tbody>
    </table>

    <input type="text" id="folder-name" placeholder="Nome da Nova Pasta">
    <button onclick="createFolder()">Criar Nova Pasta</button>
    <input type="file" id="file-input" />
    <button onclick="uploadFile()">Fazer Upload do Arquivo</button>
    <button onclick="downloadFile()">Baixar Arquivo</button>
    <button onclick="deleteFile()">Excluir Arquivo</button>
    <button onclick="goToParentFolder()">Voltar para a Pasta Anterior</button>

    <script>
        // Configuração do Firebase (usando as configurações do Financeiro)
        const firebaseConfig = {
            apiKey: "AIzaSyAIp-rFuZZsBCNVJ3pSge4TE-XUuwYygrI",
            authDomain: "agenda-6accc.firebaseapp.com",
            databaseURL: "https://agenda-6accc-default-rtdb.firebaseio.com",
            projectId: "agenda-6accc",
            storageBucket: "agenda-6accc.appspot.com",
            messagingSenderId: "794262176773",
            appId: "1:794262176773:web:c4e3837b29f635d5dc086c",
            measurementId: "G-CVBQ54PERH"
        };

        // Inicialização do Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Variáveis globais
        let currentFolder = '/';
        let files = [];

        function initFiles() {
            const filesRef = database.ref(`/files${currentFolder}`);
            filesRef.on('value', (snapshot) => {
                const filesData = snapshot.val();
                files = filesData ? Object.values(filesData) : [];
                loadFilesTable(files);
            });
        }

        function loadFilesTable(files) {
            const tableBody = document.getElementById('files-body');
            tableBody.innerHTML = "";

            if (Array.isArray(files)) {
                files.forEach((file) => {
                    const row = tableBody.insertRow();
                    const cellFileName = row.insertCell(0);
                    const cellUploadDateTime = row.insertCell(1);
                    const cellActions = row.insertCell(2);

                    cellFileName.textContent = file.name;
                    cellUploadDateTime.textContent = file.uploadDateTime;

                    const downloadButton = document.createElement('button');
                    downloadButton.textContent = 'Baixar';
                    downloadButton.onclick = () => downloadFile(file);

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Excluir';
                    deleteButton.onclick = () => deleteFile(file);

                    cellActions.appendChild(downloadButton);
                    cellActions.appendChild(deleteButton);
                });
            } else {
                console.error("Dados de arquivos inválidos:", files);
            }
        }

        function createFolder() {
            const folderName = document.getElementById('folder-name').value.trim();
            if (folderName !== '') {
                const newFolderPath = `${currentFolder}${folderName}/`;
                database.ref(`/files${newFolderPath}`).set([]);
                alert(`Nova pasta "${folderName}" criada com sucesso!`);
            } else {
                alert('Por favor, insira um nome válido para a nova pasta.');
            }
        }

        function uploadFile() {
            const fileInput = document.getElementById('file-input');
            const file = fileInput.files[0];

            if (file) {
                const uploadDateTime = getCurrentDateTime();
                const newFilePath = `${currentFolder}${file.name}`;
                const fileRef = firebase.storage().ref(newFilePath);

                fileRef.put(file).then(() => {
                    // Atualizar dados no Realtime Database
                    const newFile = {
                        name: file.name,
                        uploadDateTime: uploadDateTime
                    };
                    const updatedFiles = [...files, newFile];
                    database.ref(`/files${currentFolder}`).set(updatedFiles);

                    alert(`Arquivo "${file.name}" enviado com sucesso!`);
                }).catch((error) => {
                    console.error('Erro ao enviar o arquivo:', error.message);
                    alert('Erro ao enviar o arquivo. Por favor, tente novamente.');
                });
            } else {
                alert('Por favor, selecione um arquivo para fazer o upload.');
            }
        }

        function downloadFile(file) {
            const filePath = `${currentFolder}${file.name}`;
            const fileRef = firebase.storage().ref(filePath);

            fileRef.getDownloadURL().then((url) => {
                window.open(url, '_blank');
            }).catch((error) => {
                console.error('Erro ao obter o URL de download:', error.message);
                alert('Erro ao obter o URL de download. Por favor, tente novamente.');
            });
        }

        function deleteFile(file) {
            const confirmDelete = confirm(`Tem certeza que deseja excluir o arquivo "${file.name}"?`);

            if (confirmDelete) {
                const filePath = `${currentFolder}${file.name}`;
                const fileRef = firebase.storage().ref(filePath);

                fileRef.delete().then(() => {
                    // Atualizar dados no Realtime Database
                    const updatedFiles = files.filter(f => f.name !== file.name);
                    database.ref(`/files${currentFolder}`).set(updatedFiles);

                    alert(`Arquivo "${file.name}" excluído com sucesso!`);
                }).catch((error) => {
                    console.error('Erro ao excluir o arquivo:', error.message);
                    alert('Erro ao excluir o arquivo. Por favor, tente novamente.');
                });
            }
        }

        function getCurrentDateTime() {
            const now = new Date();
            return now.toLocaleString('pt-BR');
        }

        function goToParentFolder() {
            if (currentFolder !== '/') {
                // Remover a última parte do caminho para voltar à pasta anterior
                const parts = currentFolder.split('/').filter(part => part !== '');
                parts.pop();
                const parentFolder = `/${parts.join('/')}/`;

                // Carregar arquivos da pasta anterior
                currentFolder = parentFolder;
                const filesRef = database.ref(`/files${currentFolder}`);
                filesRef.off(); // Desligar listener para a pasta atual
                initFiles(); // Iniciar listener para a nova pasta

                alert(`Entrou na pasta "${parts.pop()}"`);
            } else {
                alert('Já está na raiz. Não pode voltar mais para trás.');
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            initFiles();
        });
    </script>
</body>

</html>


</html>


